<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•£æ­¥éš¨ç­†ï¼šç”Ÿå‘½è¶³è·¡</title>
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons Library -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFCFB;
            /* é˜²æ­¢å…§å®¹è¢«å›ºå®šåº•æ¬„é®æ“‹ */
            padding-bottom: 120px;
        }
        .animate-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        textarea:focus {
            border-color: #C19A6B;
            box-shadow: 0 0 0 2px rgba(193, 154, 107, 0.1);
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const LucideIcon = ({ name, className = "w-6 h-6" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    const iconData = window.lucide.icons[name];
                    if (iconData) {
                        const svg = iconData.toSvg({ class: className });
                        iconRef.current.innerHTML = svg;
                    }
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-block" />;
        };

        const App = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [data, setData] = useState({
                steps: [
                    { caretaker: '', personality: '', influence: '' },
                    { shameMoment: '' },
                    { unexpectedGrace: '' },
                    { earliestMemory: '' },
                    { godFootprints: '' }
                ],
                finalSummary: ''
            });
            const [copied, setCopied] = useState(false);

            const stepsInfo = [
                { title: "ç¬¬ä¸€ç«™ï¼šå…’æ™‚ç…§é¡§è€…", icon: "Heart" },
                { title: "ç¬¬äºŒç«™ï¼šç¾æ„§æ™‚åˆ»", icon: "Shield" },
                { title: "ç¬¬ä¸‰ç«™ï¼šå‡ºå¥‡ä¸æ„çš„æ©å…¸", icon: "Sun" },
                { title: "ç¬¬å››ç«™ï¼šæœ€æ—©çš„å›æ†¶", icon: "History" },
                { title: "ç¬¬äº”ç«™ï¼šä¸Šå¸ä»‹å…¥çš„è¶³è·¡", icon: "MessageSquareQuote" }
            ];

            useEffect(() => {
                const saved = localStorage.getItem('walking_meditation_flow222');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if (parsed.steps) setData(parsed);
                    } catch (e) {}
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('walking_meditation_flow222', JSON.stringify(data));
            }, [data]);

            const handleInputChange = (field, value) => {
                const newSteps = [...data.steps];
                newSteps[currentStep] = { ...newSteps[currentStep], [field]: value };
                setData({ ...data, steps: newSteps });
            };

            const exportToClipboard = () => {
                let text = `ğŸ“ã€æ•£æ­¥éš¨ç­†ï¼šç”Ÿå‘½è¶³è·¡ç´€éŒ„ã€‘\n\n`;
                text += `ğŸ“ ç¬¬ä¸€ç«™ï¼šå…’æ™‚ç…§é¡§è€…\nâ–ªï¸ ä¸»è¦ç…§é¡§è€…ï¼š${data.steps[0].caretaker || 'æœªå¡«å¯«'}\nâ–ªï¸ å½¢è±¡ç‰¹è³ªï¼š${data.steps[0].personality || 'æœªå¡«å¯«'}\nâ–ªï¸ å½±éŸ¿ï¼š${data.steps[0].influence || 'æœªå¡«å¯«'}\n\n`;
                text += `ğŸ“ ç¬¬äºŒç«™ï¼šç¾æ„§æ™‚åˆ»\nâ–ªï¸ ç¶“æ­·ï¼š${data.steps[1].shameMoment || 'æœªå¡«å¯«'}\n\n`;
                text += `ğŸ“ ç¬¬ä¸‰ç«™ï¼šå‡ºå¥‡ä¸æ„çš„æ©å…¸\nâ–ªï¸ ç¶“æ­·ï¼š${data.steps[2].unexpectedGrace || 'æœªå¡«å¯«'}\n\n`;
                text += `ğŸ“ ç¬¬å››ç«™ï¼šæœ€æ—©çš„å›æ†¶\nâ–ªï¸ å›æ†¶ï¼š${data.steps[3].earliestMemory || 'æœªå¡«å¯«'}\n\n`;
                text += `ğŸ“ ç¬¬äº”ç«™ï¼šä¸Šå¸ä»‹å…¥çš„è¶³è·¡\nâ–ªï¸ çœ‹è¦‹ï¼š${data.steps[4].godFootprints || 'æœªå¡«å¯«'}\n\n`;
                text += `âœ¨ æœ€æ·±åˆ»çš„ç¸½çµï¼š\n${data.finalSummary || 'æœªå¡«å¯«'}`;

                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {}
                document.body.removeChild(textArea);
            };

            return (
                <div className="min-h-screen max-w-md mx-auto flex flex-col">
                    {/* Header */}
                    <header className="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-md border-b border-gray-100 z-30">
                        <div className="max-w-md mx-auto px-6 py-4">
                            <h1 className="text-center text-lg font-bold text-[#4B3621] mb-3">æ•£æ­¥éš¨ç­†</h1>
                            <div className="flex gap-1">
                                {[0, 1, 2, 3, 4, 5].map((idx) => (
                                    <div key={idx} className={`h-1 flex-1 rounded-full transition-all duration-500 ${idx <= currentStep ? 'bg-[#C19A6B]' : 'bg-gray-100'}`} />
                                ))}
                            </div>
                        </div>
                    </header>

                    {/* Main Content - Added top margin to account for fixed header */}
                    <main className="mt-28 p-6 flex-grow">
                        {currentStep < 5 ? (
                            <div key={currentStep} className="animate-in space-y-6">
                                <div className="flex items-center gap-2 text-[#C19A6B]">
                                    <LucideIcon name={stepsInfo[currentStep].icon} className="w-5 h-5" />
                                    <span className="text-xs font-bold tracking-widest uppercase">Step {currentStep + 1}</span>
                                </div>
                                <h2 className="text-2xl font-bold text-[#4B3621]">{stepsInfo[currentStep].title}</h2>
                                
                                {currentStep === 0 ? (
                                    <div className="space-y-6 pb-12">
                                        <div className="space-y-2">
                                            <label className="text-base font-semibold block text-[#4B3621]">ç«¥å¹´æ™‚æœŸï¼Œä¸»è¦ç…§é¡§æˆ‘çš„äººæ˜¯...</label>
                                            <textarea className="w-full bg-white border border-gray-200 rounded-xl p-4 min-h-[60px] outline-none" value={data.steps[0].caretaker} onChange={(e) => handleInputChange('caretaker', e.target.value)} placeholder="ä¾‹å¦‚ï¼šå©†å©†ã€åª½åª½..." />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-base font-semibold block text-[#4B3621]">ä»–/å¥¹æ˜¯ä¸€å€‹æ€æ¨£çš„äººï¼Ÿ</label>
                                            <textarea className="w-full bg-white border border-gray-200 rounded-xl p-4 min-h-[100px] outline-none" value={data.steps[0].personality} onChange={(e) => handleInputChange('personality', e.target.value)} placeholder="æè¿°å…¶æ€§æ ¼..." />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-base font-semibold block text-[#4B3621]">ä»–/å¥¹å°æˆ‘çš„æ€§æƒ…ã€åƒ¹å€¼è§€æœ‰ä½•å½±éŸ¿ï¼Ÿ</label>
                                            <textarea className="w-full bg-white border border-gray-200 rounded-xl p-4 min-h-[100px] outline-none" value={data.steps[0].influence} onChange={(e) => handleInputChange('influence', e.target.value)} placeholder="å°ä½ æˆé•·çš„å°è¨˜..." />
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-2 pb-12">
                                        <label className="text-base font-semibold block text-[#4B3621]">
                                            {currentStep === 1 && "æˆ‘æ›¾ç¶“è¦ºå¾—è‡ªå·±å¥½ç¾æ„§çš„æ™‚åˆ»æ˜¯..."}
                                            {currentStep === 2 && "é‚£æ¬¡ï¼Œæˆ‘æ›¾ç¶“å¾—åˆ°éç„¡æ¢ä»¶çš„å¹«åŠ©..."}
                                            {currentStep === 3 && "æˆ‘æœ€æ—©/æœ€æ·±åˆ»èˆ‡å®¶äººç›¸è™•çš„å›æ†¶æ˜¯..."}
                                            {currentStep === 4 && "ç¥æ€æ¨£è®“æˆ‘çœ‹åˆ°ç¥‚åœ¨æˆ‘ç”Ÿå‘½ä¸­å‡ºç¾ï¼Ÿ"}
                                        </label>
                                        <textarea 
                                            className="w-full bg-white border border-gray-200 rounded-xl p-4 min-h-[300px] outline-none"
                                            value={data.steps[currentStep][Object.keys(data.steps[currentStep])[0]]}
                                            onChange={(e) => handleInputChange(Object.keys(data.steps[currentStep])[0], e.target.value)}
                                            placeholder="è«‹åœ¨é€™è£¡è¼¸å…¥å…§å®¹..."
                                        />
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div className="animate-in space-y-8 text-center pt-4">
                                <div className="inline-flex w-16 h-16 bg-[#F3EFE0] rounded-full items-center justify-center">
                                    <LucideIcon name="Share2" className="w-8 h-8 text-[#C19A6B]" />
                                </div>
                                <h2 className="text-2xl font-bold text-[#4B3621]">æ¼«æ­¥æ—…ç¨‹å‘Šä¸€æ®µè½</h2>
                                <div className="text-left space-y-2">
                                    <label className="text-base font-semibold block text-[#4B3621]">åœ¨é€™æ¬¡æ•£æ­¥æ­·ç¨‹ä¸­ï¼Œæˆ‘æœ€æ·±åˆ»çš„æ˜¯...</label>
                                    <textarea className="w-full bg-white border border-gray-200 rounded-xl p-4 min-h-[180px] outline-none" value={data.finalSummary} onChange={(e) => setData({...data, finalSummary: e.target.value})} placeholder="å¯«ä¸‹ä»Šå¤©æœ€æƒ³ç•™ä½çš„ä¸€ä»½æ„Ÿè¦º..." />
                                </div>
                                <button onClick={exportToClipboard} className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ${copied ? 'bg-green-600 text-white' : 'bg-[#4B3621] text-white'}`}>
                                    <LucideIcon name={copied ? 'Check' : 'Copy'} className="w-5 h-5" />
                                    {copied ? 'å·²è¤‡è£½å…§å®¹ï¼' : 'åŒ¯å‡ºä¸¦è¤‡è£½æˆæœ'}
                                </button>
                            </div>
                        )}
                    </main>

                    {/* Footer - Fixed bottom with safe padding */}
                    <footer className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-100 z-30 p-4">
                        <div className="max-w-md mx-auto flex gap-3">
                            <button onClick={() => {setCurrentStep(prev => prev - 1); window.scrollTo(0,0);}} disabled={currentStep === 0} className={`flex-1 py-4 rounded-xl font-bold flex items-center justify-center gap-1 ${currentStep === 0 ? 'bg-gray-50 text-gray-300' : 'bg-gray-100 text-[#4B3621]'}`}>
                                <LucideIcon name="ChevronLeft" className="w-5 h-5" /> ä¸Šä¸€ç«™
                            </button>
                            <button onClick={() => {setCurrentStep(prev => prev + 1); window.scrollTo(0,0);}} disabled={currentStep === 5} className={`flex-[1.5] py-4 rounded-xl font-bold flex items-center justify-center gap-1 shadow-sm ${currentStep === 5 ? 'bg-gray-50 text-gray-300' : 'bg-[#4B3621] text-white'}`}>
                                {currentStep === 4 ? 'æŸ¥çœ‹ç¸½çµ' : 'ä¸‹ä¸€ç«™'} <LucideIcon name="ChevronRight" className="w-5 h-5" />
                            </button>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>